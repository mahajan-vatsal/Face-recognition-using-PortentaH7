<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: README for the &lt;a href=&quot;create_tflm_arduino.py&quot; &gt;create_tflm_arduino&lt;/a&gt; script.</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">README for the &lt;a href="create_tflm_arduino.py" &gt;create_tflm_arduino&lt;/a&gt; script.</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md39"></a></p>
<p>This python 3.x script is used to create an <code>output directory</code> containing all the files necessary for a TensorFlow Lite Micro (TFLM) library. The created TFLM library is ready for use with the Arduino IDE. The <code>output directory</code> can also be used to update the <a href="https://github.com/tensorflow/tflite-micro-arduino-examples">Arduino Examples repository</a> by the repository maintainers.</p>
<p>The <a href="create_tflm_arduino.py">create_tflm_arduino</a> script accepts the following arguments:</p><ul>
<li><p class="startli"><code>--output_dir</code></p>
<p class="startli">The <code>output directory</code> for the TFLM library to be created.</p>
</li>
<li><p class="startli"><code>--base_dir</code></p>
<p class="startli">This is the <code>base directory</code> containing a base set of files from the <a href="https://github.com/tensorflow/tflite-micro">TFLM repository</a>.</p>
</li>
<li><p class="startli"><code>--manifest_file</code></p>
<p class="startli">Specifies which <code>manifest</code> file to use. The <code>manifest</code> uses Windows INI format, and <a href="MANIFEST.ini">MANIFEST.ini</a> is the default.</p>
</li>
<li><p class="startli"><code>--is_dry_run</code></p>
<p class="startli">A debugging flag. All actions that would have been taken are output, but not executed.</p>
</li>
</ul>
<p>The operation of the <a href="create_tflm_arduino.py">create_tflm_arduino</a> script is to copy files from the <a href="https://github.com/tensorflow/tflite-micro-arduino-examples">Arduino Examples repository</a> and the <code>base directory</code> to the <code>output directory</code>. Depending on file source and suffix, a content and/or file name transformation is applied. The <code>manifest</code> contains directives that determine which files are copied to the <code>output directory</code> as well as additional content transforms to apply.</p>
<p>The <code>base directory</code> is created using the <a href="https://github.com/tensorflow/tflite-micro/blob/main/tensorflow/lite/micro/tools/project_generation/create_tflm_tree.py">create_tflm_tree</a> script. This script allows for a specific platform target to be chosen, as well as which TFLM example applications are to be included in the <code>base directory</code>.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Detailed steps of the <a href="create_tflm_arduino.py">create_tflm_arduino</a> script</h1>
<ol type="1">
<li><p class="startli">Parse script arguments</p>
<p class="startli">The script command-line arguments are parsed.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Parse <code>manifest</code> file</p>
<p class="startli">Generate the following lists from the <code>manifest</code> directives:</p><ul>
<li>Files that will be copied from the repository to the <code>output directory</code></li>
<li>Files that will not be copied from the <code>base directory</code> to the <code>output directory</code></li>
<li>Files that will be copied from the repository to the <code>output directory</code> with a changed file name/path</li>
<li>Files that will be copied from the <code>base directory</code> to the <code>output directory</code> with a changed file name/path</li>
<li>Files in the <code>output directory</code> that will be transformed by a <code>sed</code> regular-expression script</li>
</ul>
<p class="startli">Each of these lists are used as filters in subsequent path tuple generation operations.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Clean the <code>output directory</code></p>
<p class="startli">Removes any files or directories in the <code>output directory</code></p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Generate list of tuples of base paths which will be transformed</p>
<p class="startli">Each tuple in the list consists of a source path relative to the <code>base directory</code>, and a destination path relative to the <code>output directory</code>.</p>
<p class="startli">The list is initially all files in the <code>base directory</code>, and is filtered by the <code>manifest</code> directives applicable to source paths in the <code>base directory</code>.</p>
<p class="startli">The list is again filtered such that only source paths with the following suffixes are included: <code>.c .cc .cpp .h .ino</code></p>
<p class="startli">All destination paths with a <code>.cc</code> suffix are changed to a <code>.cpp</code> suffix.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Generate list of tuples of base paths that will not be transformed</p>
<p class="startli">Each tuple in the list consists of a source path relative to the <code>base directory</code>, and a destination path relative to the <code>output directory</code>.</p>
<p class="startli">The list is initially all files in the <code>base directory</code>, and is filtered by the <code>manifest</code> directives applicable to source paths in the <code>base directory</code>.</p>
<p class="startli">The list is again filtered such that only source paths with the following suffixes are excluded: <code>.c .cc .cpp .h .ino</code></p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Generate list of tuples of repository paths which will be transformed</p>
<p class="startli">Each tuple in the list consists of a source path relative to the repository, and a destination path relative to the <code>output directory</code>.</p>
<p class="startli">The list is generated by the <code>manifest</code> directives applicable to source paths in the repository.</p>
<p class="startli">The list is filtered such that only source paths with the following suffixes are included: <code>.c .cc .cpp .h .ino</code></p>
<p class="startli">The list is again filtered such that it includes only files whose source path is within the <code>src/third_party</code> directory tree.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Generate list of tuples of repository paths that will not be transformed</p>
<p class="startli">Each tuple in the list consists of a source path relative to the repository, and a destination path relative to the <code>output directory</code>.</p>
<p class="startli">The list is generated by the <code>manifest</code> directives applicable to source paths in the repository.</p>
<p class="startli">The list is filtered such that only source paths with the following suffixes are excluded: <code>.c .cc .cpp .h .ino</code></p>
<p class="startli">The suffix exclusion filter is only applied where the source path is within the <code>src/third_party</code> directory tree.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Create directory tree in <code>output directory</code></p>
<p class="startli">The previously generated lists of paths are used to create the directory tree structure in <code>output directory</code>. Only directories are created, in preparation for subsequent file copy operations.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Generate dictionary of header files</p>
<p class="startli">A dictionary is generated where the keys are the names of the example applications. The value for each dictionary entry is a list of header file paths. The list of header file paths represents header files in the <code>output directory</code>, residing within each example application and under the <code>src/third_party</code> directory.</p>
<p class="startli">An additional default key entry is also generated. The value for this dictionary entry is a list of header file paths. The list of header file paths represents header files in the <code>output directory</code>, under the <code>src/third_party</code> directory.</p>
<p class="startli">This dictionary of header files is used as an input parameter to the <a href="transform_source.py">transform_source</a> script.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Transform and copy files in the list of base paths</p>
<p class="startli">The list of base paths which will be transformed is used to copy files from the <code>base directory</code> to the <code>output directory</code>. Each file to be copied is transformed using the <a href="transform_source.py">transform_source</a> script.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Transform and copy files in the list of repository paths</p>
<p class="startli">The list of repository paths which will be transformed is used to copy files from the repository to the <code>output directory</code>. Each file to be copied is transformed using the <a href="transform_source.py">transform_source</a> script.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Copy files with no transform in the list of base paths</p>
<p class="startli">The list of base paths that will not be transformed is used to copy files from the <code>base directory</code> to the <code>output directory</code>.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Copy files with no transform in the list of repository paths</p>
<p class="startli">The list of repository paths that will not be transformed is used to copy files from the repository to the <code>output directory</code>.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Flatten file tree of the example applications in the <code>output directory</code></p>
<p class="startli">Some example applications have sub-directories. These sub-directories must be flattened to make the example applications compatible with the Arduino IDE. This flatenning causes all sub-directory files to be moved to the top-level directories of the example applications. The script <a href="fix_arduino_subfolders.py">fix_arduino_subfolders</a> performs the flattening operation.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Patch files in <code>output directory</code> using <code>manifest</code> directives</p>
<p class="startli">The files in the <code>output directory</code> have <code>sed</code> regular-expression script directives applied as specified in the <code>manifest</code>.</p>
</li>
</ol>
<ol type="1">
<li><p class="startli">Remove empty directories in the <code>output directory</code></p>
<p class="startli">Remove any empty directories that are a result of the previous step of flattening the example application directories. </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
