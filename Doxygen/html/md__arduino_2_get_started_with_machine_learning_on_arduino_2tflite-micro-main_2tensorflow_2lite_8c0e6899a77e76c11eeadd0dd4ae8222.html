<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: offline_memory_plan</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">offline_memory_plan</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Offline Memory Plan<ul>
<li>Background and Motivation</li>
<li>Usage</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md178"></a>
Offline Memory Plan Via NonpersistentMemoryPlannerShim</h1>
<p>This doc outline how to use the NonPersistentMemoryPlannerShim class to work with a external tooling that can plan the offset of each non persistent buffer for the Model within the TFLM arena.</p>
<p>This is an experimental feature right now and subjected to change. Comments are welcome!</p>
<h2><a class="anchor" id="autotoc_md179"></a>
Background and Motivation</h2>
<p>The <a href="memory_management.md#offline-planned-tensor-allocations">(memory management page)</a> describes a way to specify the offset of each non persistent buffer in a flatbuffer model file. This document describe an alternative that allows the offset of each non persistent buffer for the Model within the TFLM arena to be specified by a C++ struct. The approach in this document is an early stage exploration of what the next version of offline memory planning in TFLM might look like.</p>
<p>If the NonPersistentMemoryPlannerShim is used, then the final binary does not have any of the symbols associated with the GreedyMemoryPlanner which results in a reduced memory footprint.</p>
<p>Additionally, the offline planning of the non-persistent buffers can be used to have a more efficient utilization compared to the GreedyMemoryPlanner.</p>
<h2><a class="anchor" id="autotoc_md180"></a>
Usage</h2>
<p>The more effecient memory plan above can be represented by the following C++ struct</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">struct </span>BufferPlan kOfflineNonPersistentBufferPlan = {</div>
<div class="line">  .buffer_count = 9,</div>
<div class="line">  .buffer_plan_entries = {</div>
<div class="line">    [0] = { .offset = 0 },</div>
<div class="line">    [1] = { .offset = 400 },</div>
<div class="line">    [2] = { .offset = 801 },</div>
<div class="line">    [3] = { .offset = 400 },</div>
<div class="line">    [4] = { .offset = 811 },</div>
<div class="line">    [5] = { .offset = 601 },</div>
<div class="line">    [6] = { .offset = 814 },</div>
<div class="line">    [7] = { .offset = 601 },</div>
<div class="line">    [8] = { .offset = 801 },</div>
<div class="line">   }</div>
<div class="line">};</div>
</div><!-- fragment --><p>Then you can create a NonPersistentBufferPlannerShim and provide it to the Interpreter such as below</p>
<div class="fragment"><div class="line"><span class="comment">// The arena includes both persistent buffers and non-persistent buffers. </span></div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">int</span> kArenaSize = 2*1048;</div>
<div class="line">uint8_t <a class="code hl_variable" href="network__tester__test_8cc.html#abf99e32bec994276b2bcf77385c93365">tensor_arena</a>[kArenaSize];</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtflite_1_1_non_persistent_memory_planner_shim.html">tflite::NonPersistentMemoryPlannerShim</a> planner(&amp;kOfflineNonPersistentBufferPlan);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtflite_1_1_micro_allocator.html">tflite::MicroAllocator</a> * allocator = <a class="code hl_function" href="classtflite_1_1_micro_allocator.html#a48bf21c87345607dcfd2b76c481b6eb5">tflite::MicroAllocator::Create</a>(</div>
<div class="line">  <a class="code hl_variable" href="network__tester__test_8cc.html#abf99e32bec994276b2bcf77385c93365">tensor_arena</a>, arena_size, &amp;planner);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtflite_1_1_micro_interpreter.html">tflite::MicroInterpreter</a> <a class="code hl_variable" href="_inference_allocate_tensor_8cpp.html#a0d8f3bb5211083760f7c593d57adb17d">interpreter</a>(<a class="code hl_variable" href="_arduino_2_get_started_with_machine_learning_on_arduino_2model_8h.html#ae142afd8c2e2c711c1c62440deebe03c">model</a>, op_resolver, allocator);</div>
<div class="ttc" id="a_arduino_2_get_started_with_machine_learning_on_arduino_2model_8h_html_ae142afd8c2e2c711c1c62440deebe03c"><div class="ttname"><a href="_arduino_2_get_started_with_machine_learning_on_arduino_2model_8h.html#ae142afd8c2e2c711c1c62440deebe03c">model</a></div><div class="ttdeci">const unsigned char model[]</div><div class="ttdef"><b>Definition</b> model.h:1</div></div>
<div class="ttc" id="a_inference_allocate_tensor_8cpp_html_a0d8f3bb5211083760f7c593d57adb17d"><div class="ttname"><a href="_inference_allocate_tensor_8cpp.html#a0d8f3bb5211083760f7c593d57adb17d">interpreter</a></div><div class="ttdeci">tflite::MicroInterpreter interpreter(model, resolver, tensor_arena, kTensorArenaSize, error_reporter)</div></div>
<div class="ttc" id="aclasstflite_1_1_micro_allocator_html"><div class="ttname"><a href="classtflite_1_1_micro_allocator.html">tflite::MicroAllocator</a></div><div class="ttdef"><b>Definition</b> micro_allocator.h:112</div></div>
<div class="ttc" id="aclasstflite_1_1_micro_allocator_html_a48bf21c87345607dcfd2b76c481b6eb5"><div class="ttname"><a href="classtflite_1_1_micro_allocator.html#a48bf21c87345607dcfd2b76c481b6eb5">tflite::MicroAllocator::Create</a></div><div class="ttdeci">static MicroAllocator * Create(uint8_t *tensor_arena, size_t arena_size)</div><div class="ttdef"><b>Definition</b> micro_allocator.cpp:377</div></div>
<div class="ttc" id="aclasstflite_1_1_micro_interpreter_html"><div class="ttname"><a href="classtflite_1_1_micro_interpreter.html">tflite::MicroInterpreter</a></div><div class="ttdef"><b>Definition</b> micro_interpreter.h:41</div></div>
<div class="ttc" id="aclasstflite_1_1_non_persistent_memory_planner_shim_html"><div class="ttname"><a href="classtflite_1_1_non_persistent_memory_planner_shim.html">tflite::NonPersistentMemoryPlannerShim</a></div><div class="ttdef"><b>Definition</b> non_persistent_buffer_planner_shim.h:103</div></div>
<div class="ttc" id="anetwork__tester__test_8cc_html_abf99e32bec994276b2bcf77385c93365"><div class="ttname"><a href="network__tester__test_8cc.html#abf99e32bec994276b2bcf77385c93365">tensor_arena</a></div><div class="ttdeci">uint8_t tensor_arena[TENSOR_ARENA_SIZE]</div><div class="ttdef"><b>Definition</b> network_tester_test.cc:43</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
