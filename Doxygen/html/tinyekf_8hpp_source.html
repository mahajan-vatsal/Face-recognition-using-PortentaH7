<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: Face_Access_inferencing/src/edge-impulse-sdk/classifier/postprocessing/tinyEKF/tinyekf.hpp Source File</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_05f86cf2d1c107dceef0ab0392ddcfcf.html">Face_Access_inferencing</a></li><li class="navelem"><a class="el" href="dir_a10e16a828caf535b3ccf4484f92e610.html">src</a></li><li class="navelem"><a class="el" href="dir_295f854905297c9d29514d45981534fb.html">edge-impulse-sdk</a></li><li class="navelem"><a class="el" href="dir_23fbe5a3fb0933f31748c7066d658296.html">classifier</a></li><li class="navelem"><a class="el" href="dir_b08767f3f9811ceede9c6180fa27cbcd.html">postprocessing</a></li><li class="navelem"><a class="el" href="dir_893efbc77f29dbead118af75729bdc90.html">tinyEKF</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">tinyekf.hpp</div></div>
</div><!--header-->
<div class="contents">
<a href="tinyekf_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * Extended Kalman Filter for embedded processors</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * Copyright (C) 2024 Simon D. Levy</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> *</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * MIT License</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> */</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;<a class="code" href="string_8h.html">string.h</a>&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00017" data-start="{" data-end="}">
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno"><a class="line" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">   17</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(T *arr, <span class="keywordtype">int</span> m, <span class="keywordtype">int</span> n, <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <span class="stringliteral">&quot;arr&quot;</span>) {</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">// verbose debug</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#if EI_LOG_LEVEL == 5</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    <a class="code hl_function" href="ei__run__classifier_8h.html#adda641ea28ba092cca93ceb401fe0807">ei_printf</a>(<span class="stringliteral">&quot;%s:\n&quot;</span>, name);</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m; i++) {</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>            <a class="code hl_function" href="ei__run__classifier_8h.html#adda641ea28ba092cca93ceb401fe0807">ei_printf</a>(<span class="stringliteral">&quot;[%d][%d] = %g &quot;</span>, i, j, arr[i * n + j]);</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>        }</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>        <a class="code hl_function" href="ei__run__classifier_8h.html#adda641ea28ba092cca93ceb401fe0807">ei_printf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    }</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    <a class="code hl_function" href="ei__run__classifier_8h.html#adda641ea28ba092cca93ceb401fe0807">ei_printf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>}</div>
</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="foldopen" id="foldopen00031" data-start="{" data-end="};">
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html">   31</a></span><span class="keyword">class </span><a class="code hl_class" href="class_tiny_e_k_f.html">TinyEKF</a> {</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen00033" data-start="{" data-end="}">
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a7ffcb5cd26b502e1c6080f8e489c9ac2">   33</a></span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a7ffcb5cd26b502e1c6080f8e489c9ac2">TinyEKF</a>(<span class="keyword">const</span> <span class="keywordtype">float</span>* x0, uint32_t <a class="code hl_variable" href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">EKF_N</a>, uint32_t <a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>,</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>            <span class="keywordtype">float</span> <a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a> = 0.1,</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>            <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a> = <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>            <span class="keywordtype">float</span> process_noise_scale = 0.1,</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>            <span class="keywordtype">float</span> observation_noise_scale=0.1)</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>{</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>        <span class="comment">// set private variables</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        this-&gt;EKF_N = <a class="code hl_variable" href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">EKF_N</a>;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        this-&gt;EKF_M = <a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a> = <a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">EKF_N</a>];</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * this-&gt;EKF_N);</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="comment">// x is the state</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[0] = x0[0];</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[1] = x0[1];</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[2] = x0[0];</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[3] = x0[1];</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        <span class="comment">// print init x</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 1, this-&gt;EKF_N, <span class="stringliteral">&quot;init x&quot;</span>);</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="comment">// F is the state transition model</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>        <span class="comment">// self.F = np.array(</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        <span class="comment">//     [[1, 0, self.dt, 0],</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        <span class="comment">//      [0, 1, 0, self.dt],</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        <span class="comment">//      [0, 0, 1, 0],</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        <span class="comment">//      [0, 0, 0, 1]]</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="comment">// )</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[16];</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 16);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j) {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>                <a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>[i * 4 + j] = (i == j) ? 1 : 0;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            }</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>[2] = <a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>[7] = this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        <span class="comment">// print F</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>, 4, 4, <span class="stringliteral">&quot;init F&quot;</span>);</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>        <span class="comment">// H is the observation model</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[8];</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 8);</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>[0] = <a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>[5] = 1;</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="comment">// print H</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>, 2, 4, <span class="stringliteral">&quot;init H&quot;</span>);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="comment">// Q is the covariance of the process noise</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[16];</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 16);</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        <span class="comment">// self.Q = (</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        <span class="comment">//     np.array(</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="comment">//         [</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>        <span class="comment">//             [(self.dt**4) / 4, 0, (self.dt**3) / 2, 0],</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        <span class="comment">//             [0, (self.dt**4) / 4, 0, (self.dt**3) / 2],</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        <span class="comment">//             [(self.dt**3) / 2, 0, self.dt**2, 0],</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        <span class="comment">//             [0, (self.dt**3) / 2, 0, self.dt**2],</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        <span class="comment">//         ]</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        <span class="comment">//     )</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="comment">//     * process_noise_scale**2</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        <span class="comment">// )</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[0] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[5] = pow(<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>, 4) / 4;</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[2] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[7] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[8] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[13] = pow(<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>, 3) / 2;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[10] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[15] = pow(<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>, 2);</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j) {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[i * 4 + j] = <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>[i * 4 + j] * pow(process_noise_scale, 2);</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            }</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        }</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="comment">// print Q</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>, 4, 4, <span class="stringliteral">&quot;init Q&quot;</span>);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        <span class="comment">// R is the covariance of the observation noise</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[4];</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 4);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 2; ++j) {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                <a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>[i * 2 + j] = (i == j) ? (pow(observation_noise_scale, 2)) : 0;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>            }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        }</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="comment">// print R</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>, 2, 2, <span class="stringliteral">&quot;init R&quot;</span>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        <span class="comment">// control-input mode</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>        <span class="comment">// self.B = np.array(</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        <span class="comment">//     [[(self.dt**2) / 2, 0],</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        <span class="comment">//      [0, (self.dt**2) / 2],</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        <span class="comment">//      [self.dt, 0],</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="comment">//      [0, self.dt]]</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="comment">// )</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[this-&gt;EKF_N * this-&gt;EKF_N * 2];</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * this-&gt;EKF_N * this-&gt;EKF_N * 2);</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>[0] = <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>[3] = (<a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a> * <a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>) / 2;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>[4] = <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>[7] = <a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            <a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[2];</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            <a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>[0] = <a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>[1] = 0.1;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        }</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a> = <a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <span class="comment">// P is the predict / update transition</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a> = <span class="keyword">new</span> <span class="keywordtype">float</span>[16];</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        memset(<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 16);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; ++i) {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 4; ++j) {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>[i * 4 + j] = (i == j) ? 1 : 0;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            }</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        <span class="comment">// print P</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, 4, 4, <span class="stringliteral">&quot;init P&quot;</span>);</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    }</div>
</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="foldopen" id="foldopen00158" data-start="{" data-end="}">
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#acdb80f6a01f01e455ced46ff97b75f19">  158</a></span>    <a class="code hl_function" href="class_tiny_e_k_f.html#acdb80f6a01f01e455ced46ff97b75f19">~TinyEKF</a>() {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    }</div>
</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a6587d16f906126bd068f62245335f51d">predict</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> *fx);</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="class_tiny_e_k_f.html#ac881f00d35f356835f47bfa203703521">update</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> *z, <span class="keyword">const</span> <span class="keywordtype">float</span> *hx);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">  171</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">  173</a></span>    uint32_t <a class="code hl_variable" href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">EKF_N</a>;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">  174</a></span>    uint32_t <a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">  176</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">  177</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">  178</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">  179</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">  180</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">  182</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">  183</a></span>    <span class="keywordtype">float</span> *<a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">  184</a></span>    <span class="keywordtype">float</span> <a class="code hl_variable" href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">dt</a>;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a2c0ea5d964f1e7241065192a4dfe12a0">update_step3</a>(<span class="keywordtype">float</span> *GH);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="foldopen" id="foldopen00189" data-start="{" data-end="}">
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">  189</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a,</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>,</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>            <span class="keywordtype">float</span> * c,</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> arows,</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> acols,</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> bcols)</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    {</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;arows; ++i) {</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;bcols; ++j) {</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>                c[i*bcols+j] = 0;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;acols; ++k) {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                    c[i*bcols+j] += a[i*acols+k] * <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>[k*bcols+j];</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            }</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        }</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    }</div>
</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="foldopen" id="foldopen00208" data-start="{" data-end="}">
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a9f80e58f7494a90857d89fad40469006">  208</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a9f80e58f7494a90857d89fad40469006">_mulvec</a>(</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a,</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>,</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            <span class="keywordtype">float</span> * <a class="code hl_variable" href="_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcbb3c8e6cb6b1b9e60f2136ee8b58a8b6.html#aa4f0d3eebc3c443f9be81bf48561a217">y</a>,</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> m,</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    {</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m; ++i) {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            <a class="code hl_variable" href="_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcbb3c8e6cb6b1b9e60f2136ee8b58a8b6.html#aa4f0d3eebc3c443f9be81bf48561a217">y</a>[i] = 0;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                <a class="code hl_variable" href="_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcbb3c8e6cb6b1b9e60f2136ee8b58a8b6.html#aa4f0d3eebc3c443f9be81bf48561a217">y</a>[i] += <a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[j] * a[i*n+j];</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        }</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    }</div>
</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="foldopen" id="foldopen00223" data-start="{" data-end="}">
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a472c14c46d895000763f19a724fc5990">  223</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a472c14c46d895000763f19a724fc5990">_transpose</a>(</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a, <span class="keywordtype">float</span> * at, <span class="keyword">const</span> <span class="keywordtype">int</span> m, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    {</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m; ++i)</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j) {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                at[j*m+i] = a[i*n+j];</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    }</div>
</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="foldopen" id="foldopen00233" data-start="{" data-end="}">
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#ab82d84e103eaa84e06dd31686782733e">  233</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#ab82d84e103eaa84e06dd31686782733e">_addmat</a>(</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a, <span class="keyword">const</span> <span class="keywordtype">float</span> * <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>, <span class="keywordtype">float</span> * c,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            <span class="keyword">const</span> <span class="keywordtype">int</span> m, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    {</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m; ++i) {</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j) {</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                c[i*n+j] = a[i*n+j] + <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>[i*n+j];</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            }</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        }</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    }</div>
</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="foldopen" id="foldopen00245" data-start="{" data-end="}">
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a1d4604bc0bc76fc9f374e9ad48e466cf">  245</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a1d4604bc0bc76fc9f374e9ad48e466cf">_negate</a>(<span class="keywordtype">float</span> * a, <span class="keyword">const</span> <span class="keywordtype">int</span> m, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    {</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m; ++i) {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j) {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                a[i*n+j] = -a[i*n+j];</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            }</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    }</div>
</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="foldopen" id="foldopen00255" data-start="{" data-end="}">
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#aaca49d35f3feaf3817108c33bb758580">  255</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#aaca49d35f3feaf3817108c33bb758580">_addeye</a>(<span class="keywordtype">float</span> * a, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; ++i) {</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>            a[i*n+i] += 1;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>        }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    }</div>
</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="comment">/* Cholesky-decomposition matrix-inversion code, adapated from</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span><span class="comment">    http://jean-pierre.moreau.pagesperso-orange.fr/Cplus/_choles_cpp.txt */</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span> </div>
<div class="foldopen" id="foldopen00266" data-start="{" data-end="}">
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#af11f9654c1caed098f7f63b01641dcf2">  266</a></span>    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="class_tiny_e_k_f.html#af11f9654c1caed098f7f63b01641dcf2">_choldc1</a>(<span class="keywordtype">float</span> * a, <span class="keywordtype">float</span> * p, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i; j &lt; n; j++) {</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                <span class="keywordtype">float</span> sum = a[i*n+j];</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = i - 1; k &gt;= 0; k--) {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                    sum -= a[i*n+k] * a[j*n+k];</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                }</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                <span class="keywordflow">if</span> (i == j) {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                    <span class="keywordflow">if</span> (sum &lt;= 0) {</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                        <span class="keywordflow">return</span> 1; <span class="comment">/* error */</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                    }</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                    p[i] = sqrt(sum);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                }</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                    a[j*n+i] = sum / p[i];</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        }</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        <span class="keywordflow">return</span> 0; <span class="comment">// success:w</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    }</div>
</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="foldopen" id="foldopen00290" data-start="{" data-end="}">
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a6929102109bfa796fb655ad9b161905f">  290</a></span>    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a6929102109bfa796fb655ad9b161905f">_choldcsl</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> * A, <span class="keywordtype">float</span> * a, <span class="keywordtype">float</span> * p, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    {</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; n; j++) {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                a[i*n+j] = A[i*n+j];</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            }</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        }</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="class_tiny_e_k_f.html#af11f9654c1caed098f7f63b01641dcf2">_choldc1</a>(a, p, n)) {</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            a[i*n+i] = 1 / p[i];</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i + 1; j &lt; n; j++) {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                <span class="keywordtype">float</span> sum = 0;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = i; k &lt; j; k++) {</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                    sum -= a[j*n+k] * a[k*n+i];</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                }</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                a[j*n+i] = sum / p[j];</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        }</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span> </div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        <span class="keywordflow">return</span> 0; <span class="comment">// success</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    }</div>
</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="foldopen" id="foldopen00315" data-start="{" data-end="}">
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a553c50411a48e4480a1126dbce3187df">  315</a></span>    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a553c50411a48e4480a1126dbce3187df">_cholsl</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> * A, <span class="keywordtype">float</span> * a, <span class="keywordtype">float</span> * p, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="class_tiny_e_k_f.html#a6929102109bfa796fb655ad9b161905f">_choldcsl</a>(A,a,p,n)) {</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i + 1; j &lt; n; j++) {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                a[i*n+j] = 0.0;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            }</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>        }</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            a[i*n+i] *= a[i*n+i];</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = i + 1; k &lt; n; k++) {</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                a[i*n+i] += a[k*n+i] * a[k*n+i];</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>            }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i + 1; j &lt; n; j++) {</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = j; k &lt; n; k++) {</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                    a[i*n+j] += a[k*n+i] * a[k*n+j];</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                }</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            }</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        }</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++) {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; i; j++) {</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                a[i*n+j] = a[j*n+i];</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        }</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        <span class="keywordflow">return</span> 0; <span class="comment">// success</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    }</div>
</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="foldopen" id="foldopen00347" data-start="{" data-end="}">
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a3f9b74921fb5bba545caec4d43907595">  347</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a3f9b74921fb5bba545caec4d43907595">_addvec</a>(</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a, <span class="keyword">const</span> <span class="keywordtype">float</span> * <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>, <span class="keywordtype">float</span> * c, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    {</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j) {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>            c[j] = a[j] + <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>[j];</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>        }</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    }</div>
</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="foldopen" id="foldopen00356" data-start="{" data-end="}">
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a8a3a0773ff1132e6c10879d57cbe4355">  356</a></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a8a3a0773ff1132e6c10879d57cbe4355">_sub</a>(</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> * a, <span class="keyword">const</span> <span class="keywordtype">float</span> * <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>, <span class="keywordtype">float</span> * c, <span class="keyword">const</span> <span class="keywordtype">int</span> n)</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    {</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; ++j) {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            c[j] = a[j] - <a class="code hl_variable" href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a>[j];</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        }</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    }</div>
</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="foldopen" id="foldopen00365" data-start="{" data-end="}">
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a50842a020ce85de5f5f8f2e27be09601">  365</a></span>    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a50842a020ce85de5f5f8f2e27be09601">invert</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> * a, <span class="keywordtype">float</span> * ainv, uint32_t <a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>)</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <span class="keywordtype">float</span> tmp[<a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>];</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a553c50411a48e4480a1126dbce3187df">_cholsl</a>(a, ainv, tmp, <a class="code hl_variable" href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">EKF_M</a>) == 0;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    }</div>
</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>};</div>
</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span> </div>
<div class="foldopen" id="foldopen00373" data-start="{" data-end="}">
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a6587d16f906126bd068f62245335f51d">  373</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a6587d16f906126bd068f62245335f51d">TinyEKF::predict</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> *fx) {</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="comment">// self.x = self.F @ self.x + self.B @ self.u</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <span class="keywordtype">float</span> Bu[4];</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">B</a>, this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">u</a>, Bu, 4, 2, 1);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="comment">// print Bu</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(Bu, 4, 1, <span class="stringliteral">&quot;Bu&quot;</span>);</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// print x before</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 1, 4, <span class="stringliteral">&quot;x before&quot;</span>);</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="keywordtype">float</span> Fx[8];</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>, this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, Fx, 4, 4, 2);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// print Fx</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(Fx, 4, 2, <span class="stringliteral">&quot;Fx&quot;</span>);</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="comment">// print x after</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 1, 4, <span class="stringliteral">&quot;x after&quot;</span>);</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span> </div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="comment">//_addmat(Fx, Bu, this-&gt;x, 4, 1);</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[0] = Fx[0] + Bu[0];</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[1] = Fx[1] + Bu[1];</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[2] = Fx[2] + Bu[0];</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[3] = Fx[3] + Bu[1];</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[4] = Fx[4] + Bu[2];</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[5] = Fx[5] + Bu[3];</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[6] = Fx[6] + Bu[2];</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>[7] = Fx[7] + Bu[3];</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">// this is the formula for the next part</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">// self.P_pre = np.dot(F, self.P_post).dot(F.T) + Q</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span> </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="comment">// np.dot(F, self.P_post)</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="keywordtype">float</span> FP[16];</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>, <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, FP, 4, 4, 4);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="comment">// print FP</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(FP, 4, 4, <span class="stringliteral">&quot;FP&quot;</span>);</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="comment">// F.T</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keywordtype">float</span> Ft[16];</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a472c14c46d895000763f19a724fc5990">_transpose</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">F</a>, Ft, 4, 4);</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    <span class="comment">// .dot(F.T)</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="keywordtype">float</span> FPFt[16];</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(FP, Ft, FPFt, 4, 4, 4);</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="comment">// + Q</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#ab82d84e103eaa84e06dd31686782733e">_addmat</a>(FPFt, <a class="code hl_variable" href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">Q</a>, <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, 4, 4);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="comment">// print P</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, 4, 4, <span class="stringliteral">&quot;P&quot;</span>);</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>}</div>
</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="foldopen" id="foldopen00428" data-start="{" data-end="}">
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#ac881f00d35f356835f47bfa203703521">  428</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="class_tiny_e_k_f.html#ac881f00d35f356835f47bfa203703521">TinyEKF::update</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> *z, <span class="keyword">const</span> <span class="keywordtype">float</span> *hx) {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    <span class="keywordtype">float</span> Ht[8];</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a472c14c46d895000763f19a724fc5990">_transpose</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>, Ht, 2, 4);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <span class="comment">// print Ht</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(Ht, 4, 2, <span class="stringliteral">&quot;Ht&quot;</span>);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="keywordtype">float</span> PHt[8];</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, Ht, PHt, 4, 4, 2);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="keywordtype">float</span> HP[8];</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(<a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>, <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, HP, 2, 4, 4);</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="keywordtype">float</span> HpHt[4];</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(HP, Ht, HpHt, 2, 4, 2);</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="keywordtype">float</span> HpHtR[4];</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#ab82d84e103eaa84e06dd31686782733e">_addmat</a>(HpHt, <a class="code hl_variable" href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">R</a>, HpHtR, 2, 2);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <span class="keywordtype">float</span> HPHtRinv[4];</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="class_tiny_e_k_f.html#a50842a020ce85de5f5f8f2e27be09601">invert</a>(HpHtR, HPHtRinv, 2)) {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordtype">float</span> G[8];</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(PHt, HPHtRinv, G, 4, 2, 2);</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="comment">// print G</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(G, 4, 2, <span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="comment">// print x</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 1, 4, <span class="stringliteral">&quot;x in update&quot;</span>);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <span class="comment">// we get hx as an argument to function</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="keywordtype">float</span> z_hx[4];</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="comment">//_sub(z, Hx, z_hx, 2);</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    z_hx[0] = z[0] - hx[0];</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    z_hx[1] = z[1] - hx[1];</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    z_hx[2] = z[0] - hx[0];</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    z_hx[3] = z[1] - hx[1];</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span> </div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="comment">// print z_hx</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(z_hx, 2, 2, <span class="stringliteral">&quot;z_hx&quot;</span>);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    <span class="keywordtype">float</span> Gz_hx[8];</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(G, z_hx, Gz_hx, 4, 2, 2);</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="comment">// // print Gz_hx</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <a class="code hl_function" href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a>(Gz_hx, 4, 2, <span class="stringliteral">&quot;Gz_hx&quot;</span>);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a3f9b74921fb5bba545caec4d43907595">_addvec</a>(this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, Gz_hx, this-&gt;<a class="code hl_variable" href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">x</a>, 8);</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="keywordtype">float</span> GH[16];</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(G, <a class="code hl_variable" href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">H</a>, GH, 4, 2, 4);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a2c0ea5d964f1e7241065192a4dfe12a0">update_step3</a>(GH);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>}</div>
</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="foldopen" id="foldopen00488" data-start="{" data-end="}">
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno"><a class="line" href="class_tiny_e_k_f.html#a2c0ea5d964f1e7241065192a4dfe12a0">  488</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="class_tiny_e_k_f.html#a2c0ea5d964f1e7241065192a4dfe12a0">TinyEKF::update_step3</a>(<span class="keywordtype">float</span> *GH)</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>{</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a1d4604bc0bc76fc9f374e9ad48e466cf">_negate</a>(GH, 4, 4);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#aaca49d35f3feaf3817108c33bb758580">_addeye</a>(GH, 4);</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="keywordtype">float</span> GHP[16];</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <a class="code hl_function" href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">_mulmat</a>(GH, <a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, GHP, 4, 4, 4);</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    memcpy(<a class="code hl_variable" href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">P</a>, GHP, 16 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>}</div>
</div>
<div class="ttc" id="a_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcbb3c8e6cb6b1b9e60f2136ee8b58a8b6_html_aa4f0d3eebc3c443f9be81bf48561a217"><div class="ttname"><a href="_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcbb3c8e6cb6b1b9e60f2136ee8b58a8b6.html#aa4f0d3eebc3c443f9be81bf48561a217">y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition</b> detection_postprocess.cpp:80</div></div>
<div class="ttc" id="a_test_a_p_d_s9960_color_8ino_html_a148e3876077787926724625411d6e7a9"><div class="ttname"><a href="_test_a_p_d_s9960_color_8ino.html#a148e3876077787926724625411d6e7a9">b</a></div><div class="ttdeci">int b</div><div class="ttdef"><b>Definition</b> TestAPDS9960Color.ino:12</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html"><div class="ttname"><a href="class_tiny_e_k_f.html">TinyEKF</a></div><div class="ttdef"><b>Definition</b> tinyekf.hpp:31</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a0548cb32a953a77419e3a6e668627088"><div class="ttname"><a href="class_tiny_e_k_f.html#a0548cb32a953a77419e3a6e668627088">TinyEKF::H</a></div><div class="ttdeci">float * H</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:179</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a1d4604bc0bc76fc9f374e9ad48e466cf"><div class="ttname"><a href="class_tiny_e_k_f.html#a1d4604bc0bc76fc9f374e9ad48e466cf">TinyEKF::_negate</a></div><div class="ttdeci">static void _negate(float *a, const int m, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:245</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a2c0ea5d964f1e7241065192a4dfe12a0"><div class="ttname"><a href="class_tiny_e_k_f.html#a2c0ea5d964f1e7241065192a4dfe12a0">TinyEKF::update_step3</a></div><div class="ttdeci">void update_step3(float *GH)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:488</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a3f9b74921fb5bba545caec4d43907595"><div class="ttname"><a href="class_tiny_e_k_f.html#a3f9b74921fb5bba545caec4d43907595">TinyEKF::_addvec</a></div><div class="ttdeci">static void _addvec(const float *a, const float *b, float *c, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:347</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a434e2edcdb50a550acbee21523744c1f"><div class="ttname"><a href="class_tiny_e_k_f.html#a434e2edcdb50a550acbee21523744c1f">TinyEKF::EKF_M</a></div><div class="ttdeci">uint32_t EKF_M</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:174</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a472c14c46d895000763f19a724fc5990"><div class="ttname"><a href="class_tiny_e_k_f.html#a472c14c46d895000763f19a724fc5990">TinyEKF::_transpose</a></div><div class="ttdeci">static void _transpose(const float *a, float *at, const int m, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:223</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a50842a020ce85de5f5f8f2e27be09601"><div class="ttname"><a href="class_tiny_e_k_f.html#a50842a020ce85de5f5f8f2e27be09601">TinyEKF::invert</a></div><div class="ttdeci">static bool invert(const float *a, float *ainv, uint32_t EKF_M)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:365</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a553c50411a48e4480a1126dbce3187df"><div class="ttname"><a href="class_tiny_e_k_f.html#a553c50411a48e4480a1126dbce3187df">TinyEKF::_cholsl</a></div><div class="ttdeci">static int _cholsl(const float *A, float *a, float *p, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:315</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a623bc6026100a274a225e6edf6edf051"><div class="ttname"><a href="class_tiny_e_k_f.html#a623bc6026100a274a225e6edf6edf051">TinyEKF::_mulmat</a></div><div class="ttdeci">static void _mulmat(const float *a, const float *b, float *c, const int arows, const int acols, const int bcols)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:189</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a6587d16f906126bd068f62245335f51d"><div class="ttname"><a href="class_tiny_e_k_f.html#a6587d16f906126bd068f62245335f51d">TinyEKF::predict</a></div><div class="ttdeci">void predict(const float *fx)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:373</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a6929102109bfa796fb655ad9b161905f"><div class="ttname"><a href="class_tiny_e_k_f.html#a6929102109bfa796fb655ad9b161905f">TinyEKF::_choldcsl</a></div><div class="ttdeci">static int _choldcsl(const float *A, float *a, float *p, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:290</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a79c584d76fd4ee4c4f94e24cab44dbd2"><div class="ttname"><a href="class_tiny_e_k_f.html#a79c584d76fd4ee4c4f94e24cab44dbd2">TinyEKF::x</a></div><div class="ttdeci">float * x</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:171</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a7ffcb5cd26b502e1c6080f8e489c9ac2"><div class="ttname"><a href="class_tiny_e_k_f.html#a7ffcb5cd26b502e1c6080f8e489c9ac2">TinyEKF::TinyEKF</a></div><div class="ttdeci">TinyEKF(const float *x0, uint32_t EKF_N, uint32_t EKF_M, float dt=0.1, float *u=nullptr, float process_noise_scale=0.1, float observation_noise_scale=0.1)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:33</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a8440c53aede307e97e7926e6e255a35b"><div class="ttname"><a href="class_tiny_e_k_f.html#a8440c53aede307e97e7926e6e255a35b">TinyEKF::P</a></div><div class="ttdeci">float * P</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:176</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a8a3a0773ff1132e6c10879d57cbe4355"><div class="ttname"><a href="class_tiny_e_k_f.html#a8a3a0773ff1132e6c10879d57cbe4355">TinyEKF::_sub</a></div><div class="ttdeci">static void _sub(const float *a, const float *b, float *c, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:356</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a9a78e0086b9250898cfd099bdb67f217"><div class="ttname"><a href="class_tiny_e_k_f.html#a9a78e0086b9250898cfd099bdb67f217">TinyEKF::R</a></div><div class="ttdeci">float * R</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:180</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_a9f80e58f7494a90857d89fad40469006"><div class="ttname"><a href="class_tiny_e_k_f.html#a9f80e58f7494a90857d89fad40469006">TinyEKF::_mulvec</a></div><div class="ttdeci">static void _mulvec(const float *a, const float *x, float *y, const int m, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:208</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_aaca49d35f3feaf3817108c33bb758580"><div class="ttname"><a href="class_tiny_e_k_f.html#aaca49d35f3feaf3817108c33bb758580">TinyEKF::_addeye</a></div><div class="ttdeci">static void _addeye(float *a, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:255</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_aae2c7c321938a5b16f130b224093c8b0"><div class="ttname"><a href="class_tiny_e_k_f.html#aae2c7c321938a5b16f130b224093c8b0">TinyEKF::EKF_N</a></div><div class="ttdeci">uint32_t EKF_N</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:173</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_ab6a93711470f38604199ed5127c469a3"><div class="ttname"><a href="class_tiny_e_k_f.html#ab6a93711470f38604199ed5127c469a3">TinyEKF::dt</a></div><div class="ttdeci">float dt</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:184</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_ab82d84e103eaa84e06dd31686782733e"><div class="ttname"><a href="class_tiny_e_k_f.html#ab82d84e103eaa84e06dd31686782733e">TinyEKF::_addmat</a></div><div class="ttdeci">static void _addmat(const float *a, const float *b, float *c, const int m, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:233</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_ac881f00d35f356835f47bfa203703521"><div class="ttname"><a href="class_tiny_e_k_f.html#ac881f00d35f356835f47bfa203703521">TinyEKF::update</a></div><div class="ttdeci">bool update(const float *z, const float *hx)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:428</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_acdb80f6a01f01e455ced46ff97b75f19"><div class="ttname"><a href="class_tiny_e_k_f.html#acdb80f6a01f01e455ced46ff97b75f19">TinyEKF::~TinyEKF</a></div><div class="ttdeci">~TinyEKF()</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:158</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_acefedd03900c8ce707b50469bd41b7cb"><div class="ttname"><a href="class_tiny_e_k_f.html#acefedd03900c8ce707b50469bd41b7cb">TinyEKF::Q</a></div><div class="ttdeci">float * Q</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:177</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_ad4b9c26b7340f0336a0759c4317cfcc4"><div class="ttname"><a href="class_tiny_e_k_f.html#ad4b9c26b7340f0336a0759c4317cfcc4">TinyEKF::F</a></div><div class="ttdeci">float * F</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:178</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_adfeae03c37e5e99b40c12a239225847a"><div class="ttname"><a href="class_tiny_e_k_f.html#adfeae03c37e5e99b40c12a239225847a">TinyEKF::u</a></div><div class="ttdeci">float * u</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:183</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_ae620b284598143c9a78154ff0943fabb"><div class="ttname"><a href="class_tiny_e_k_f.html#ae620b284598143c9a78154ff0943fabb">TinyEKF::B</a></div><div class="ttdeci">float * B</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:182</div></div>
<div class="ttc" id="aclass_tiny_e_k_f_html_af11f9654c1caed098f7f63b01641dcf2"><div class="ttname"><a href="class_tiny_e_k_f.html#af11f9654c1caed098f7f63b01641dcf2">TinyEKF::_choldc1</a></div><div class="ttdeci">static int _choldc1(float *a, float *p, const int n)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:266</div></div>
<div class="ttc" id="aei__run__classifier_8h_html_adda641ea28ba092cca93ceb401fe0807"><div class="ttname"><a href="ei__run__classifier_8h.html#adda641ea28ba092cca93ceb401fe0807">ei_printf</a></div><div class="ttdeci">result timing dsp_us ei_printf_float((float) result-&gt;timing.dsp_us/1000) ei_printf(&quot; ms., Classification: &quot;)</div></div>
<div class="ttc" id="astring_8h_html"><div class="ttname"><a href="string_8h.html">string.h</a></div></div>
<div class="ttc" id="atinyekf_8hpp_html_a93995f1925e52bd082005abe44553f07"><div class="ttname"><a href="tinyekf_8hpp.html#a93995f1925e52bd082005abe44553f07">print_arr</a></div><div class="ttdeci">void print_arr(T *arr, int m, int n, const char *name=&quot;arr&quot;)</div><div class="ttdef"><b>Definition</b> tinyekf.hpp:17</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
