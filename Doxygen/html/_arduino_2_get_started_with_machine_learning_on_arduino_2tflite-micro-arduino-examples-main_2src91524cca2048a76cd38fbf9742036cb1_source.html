<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: Arduino/GetStartedWithMachineLearningOnArduino/tflite-micro-arduino-examples-main/src/third_party/ruy/ruy/profiler/instrumentation.h Source File</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_a991eec27578c865874ede3d8ec657c2.html">Arduino</a></li><li class="navelem"><a class="el" href="dir_5b434fadadbc73afff09af364c4592fa.html">GetStartedWithMachineLearningOnArduino</a></li><li class="navelem"><a class="el" href="dir_0d2ed21f8b79a9b0d8abfa821a489de0.html">tflite-micro-arduino-examples-main</a></li><li class="navelem"><a class="el" href="dir_e866ddbbaec9cd84ea4c87a9de153242.html">src</a></li><li class="navelem"><a class="el" href="dir_132e7ec5e48d289908f71c63bf9105bc.html">third_party</a></li><li class="navelem"><a class="el" href="dir_80f2a576f317d856016399142f1da54a.html">ruy</a></li><li class="navelem"><a class="el" href="dir_0ee8abb360380957b48f6ae75bba15a1.html">ruy</a></li><li class="navelem"><a class="el" href="dir_5a85ed0ccb03e0491c7ec04f661f6b7c.html">profiler</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">instrumentation.h</div></div>
</div><!--header-->
<div class="contents">
<a href="_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2src91524cca2048a76cd38fbf9742036cb1.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/* Copyright 2020 Google LLC. All Rights Reserved.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"></span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">you may not use this file except in compliance with the License.</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">You may obtain a copy of the License at</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"></span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"></span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">See the License for the specific language governing permissions and</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">limitations under the License.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">==============================================================================*/</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#ifndef RUY_RUY_PROFILER_INSTRUMENTATION_H_</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#define RUY_RUY_PROFILER_INSTRUMENTATION_H_</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#ifdef RUY_PROFILER</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="foldopen" id="foldopen00025" data-start="{" data-end="}">
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="namespaceruy.html">   25</a></span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceruy.html">ruy</a> {</div>
<div class="foldopen" id="foldopen00026" data-start="{" data-end="}">
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="namespaceruy_1_1profiler.html">   26</a></span><span class="keyword">namespace </span>profiler {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#ifdef RUY_PROFILER</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">// A label is how a code scope is annotated to appear in profiles.</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">// The stacks that are sampled by the profiler are stacks of such labels.</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">// A label consists of a literal string, plus optional integer arguments.</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="keyword">class </span>Label {</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>  Label() {}</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>  <span class="keyword">explicit</span> Label(Args... args) {</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    Set(args...);</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  }</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>  <span class="keywordtype">void</span> Set(<span class="keyword">const</span> <span class="keywordtype">char</span>* format) {</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    format_ = format;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    args_count_ = 0;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>  }</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>  <span class="keywordtype">void</span> Set(<span class="keyword">const</span> <span class="keywordtype">char</span>* format, Args... args) {</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    format_ = format;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    args_count_ = <span class="keyword">sizeof</span>...(args);</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    SetArgs(0, args...);</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>  }</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  <span class="keywordtype">void</span> operator=(<span class="keyword">const</span> Label&amp; other);</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>  <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> Label&amp; other) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>  std::string Formatted() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* format()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> format_; }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <span class="keywordtype">void</span> SetArgs(<span class="keywordtype">int</span> position, <span class="keywordtype">int</span> arg0) { args_[position] = arg0; }</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  <span class="keywordtype">void</span> SetArgs(<span class="keywordtype">int</span> position, <span class="keywordtype">int</span> arg0, Args... args) {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    SetArgs(position, arg0);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    SetArgs(position + 1, args...);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  }</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxArgs = 4;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* format_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  <span class="keywordtype">int</span> args_count_ = 0;</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>  <span class="keywordtype">int</span> args_[kMaxArgs];</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>};</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="keyword">namespace </span>detail {</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment">// Forward-declaration, see class ThreadStack below.</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="keyword">class </span>ThreadStack;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="keywordtype">bool</span>&amp; GlobalIsProfilerRunning();</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment">// Returns the global vector of pointers to all stacks, there being one stack</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment">// per thread executing instrumented code.</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>std::vector&lt;ThreadStack*&gt;* GlobalAllThreadStacks();</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">// Returns the mutex to be locked around any access to GlobalAllThreadStacks().</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>std::mutex* GlobalsMutex();</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment">// Returns the thread-local stack, specific to the current thread.</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>ThreadStack* ThreadLocalThreadStack();</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment">// This &#39;stack&#39; is what may be more appropriately called a &#39;pseudostack&#39;:</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">// It contains Label entries that are &#39;manually&#39; entered by instrumentation</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">// code. It&#39;s unrelated to real call stacks.</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="keyword">struct </span>Stack {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  std::uint32_t <span class="keywordtype">id</span> = 0;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxSize = 64;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="hello__world__model_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = 0;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  Label <a class="code hl_variable" href="ei__fill__result__struct_8h.html#ab36422f9ce90634e6563fb1f2905fb93">labels</a>[kMaxSize];</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>};</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="comment">// Returns the buffer byte size required by CopyToSample.</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="keywordtype">int</span> GetBufferSize(<span class="keyword">const</span> Stack&amp; stack);</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="comment">// Copies this Stack into a byte buffer, called a &#39;sample&#39;.</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="keywordtype">void</span> CopyToBuffer(<span class="keyword">const</span> Stack&amp; stack, <span class="keywordtype">char</span>* dst);</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment">// Populates this Stack from an existing sample buffer, typically</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment">// produced by CopyToSample.</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="keywordtype">void</span> ReadFromBuffer(<span class="keyword">const</span> <span class="keywordtype">char</span>* src, Stack* stack);</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span> </div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">// ThreadStack is meant to be used as a thread-local singleton, assigning to</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">// each thread a Stack object holding its pseudo-stack of profile labels,</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">// plus a mutex allowing to synchronize accesses to this pseudo-stack between</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">// this thread and a possible profiler thread sampling it.</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="keyword">class </span>ThreadStack {</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>  ThreadStack();</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>  ~ThreadStack();</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  <span class="keyword">const</span> Stack&amp; stack()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> stack_; }</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>  <span class="comment">// Returns the mutex to lock around any access to this stack. Each stack is</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>  <span class="comment">// accessed by potentially two threads: the thread that it belongs to</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>  <span class="comment">// (which calls Push and Pop) and the profiler thread during profiling</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  <span class="comment">// (which calls CopyToSample).</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>  std::mutex&amp; Mutex()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mutex_; }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>  <span class="comment">// Pushes a new label on the top of this Stack.</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>  <span class="keywordtype">void</span> Push(Args... args) {</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="comment">// This mutex locking is needed to guard against race conditions as both</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">// the current thread and the profiler thread may be concurrently accessing</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="comment">// this stack. In addition to that, this mutex locking also serves the other</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">// purpose of acting as a barrier (of compiler code reordering, of runtime</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">// CPU instruction reordering, and of memory access reordering), which</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">// gives a measure of correctness to this profiler. The downside is some</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="comment">// latency. As this lock will be uncontended most of the times, the cost</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="comment">// should be roughly that of an sequentially-consistent atomic access,</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="comment">// comparable to an access to the level of CPU data cache that is shared</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// among all cores, typically 60 cycles on current ARM CPUs, plus side</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment">// effects from barrier instructions.</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    std::lock_guard&lt;std::mutex&gt; lock(mutex_);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment">// Avoid overrunning the stack, even in &#39;release&#39; builds. This profiling</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="comment">// instrumentation code should not ship in release builds anyway, the</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="comment">// overhead of this check is negligible, and overrunning a stack array would</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="comment">// be bad.</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="keywordflow">if</span> (stack_.size &gt;= Stack::kMaxSize) {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>      abort();</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    }</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    stack_.labels[stack_.size++].Set(args...);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>  }</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>  <span class="comment">// Pops the top-most label from this Stack.</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>  <span class="keywordtype">void</span> Pop() {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">// See the comment in Push about this lock. While it would be tempting to</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// try to remove this lock and just atomically decrement size_ with a</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="comment">// store-release, that would not necessarily be a substitute for all of the</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">// purposes that this lock serves, or if it was done carefully to serve all</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="comment">// of the same purposes, then that wouldn&#39;t be faster than this (mostly</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// uncontended) lock.</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    std::lock_guard&lt;std::mutex&gt; lock(mutex_);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    stack_.size--;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>  }</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>  <span class="keyword">mutable</span> std::mutex mutex_;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  Stack stack_;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>};</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>}  <span class="comment">// namespace detail</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">// RAII user-facing way to construct Labels associated with their life scope</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="comment">// and get them pushed to / popped from the current thread stack.</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="keyword">class </span><a class="code hl_class" href="classruy_1_1profiler_1_1_scope_label.html">ScopeLabel</a> {</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  <a class="code hl_function" href="classruy_1_1profiler_1_1_scope_label.html#af98ec6595418e55520942b3773735bad">ScopeLabel</a>(Args... args) : thread_stack_(detail::ThreadLocalThreadStack()) {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    thread_stack_-&gt;Push(args...);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  }</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <a class="code hl_function" href="classruy_1_1profiler_1_1_scope_label.html#a2022fde84a7503ebeb460c49465584ce">~ScopeLabel</a>() { thread_stack_-&gt;Pop(); }</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>  detail::ThreadStack* thread_stack_;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>};</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="preprocessor">#else  </span><span class="comment">// no RUY_PROFILER</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="keyword">class </span><a class="code hl_class" href="classruy_1_1profiler_1_1_scope_label.html">ScopeLabel</a> {</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno"><a class="line" href="classruy_1_1profiler_1_1_scope_label.html#af98ec6595418e55520942b3773735bad">  191</a></span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classruy_1_1profiler_1_1_scope_label.html#af98ec6595418e55520942b3773735bad">ScopeLabel</a>(Args...) {}</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  <span class="comment">// This destructor is needed to consistently silence clang&#39;s -Wunused-variable</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>  <span class="comment">// which seems to trigger semi-randomly.</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno"><a class="line" href="classruy_1_1profiler_1_1_scope_label.html#a2022fde84a7503ebeb460c49465584ce">  195</a></span>  <a class="code hl_function" href="classruy_1_1profiler_1_1_scope_label.html#a2022fde84a7503ebeb460c49465584ce">~ScopeLabel</a>() {}</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>};</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>}  <span class="comment">// namespace profiler</span></div>
</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>}  <span class="comment">// namespace ruy</span></div>
</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span> </div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="preprocessor">#endif  </span><span class="comment">// RUY_RUY_PROFILER_INSTRUMENTATION_H_</span></div>
<div class="ttc" id="aclassruy_1_1profiler_1_1_scope_label_html"><div class="ttname"><a href="classruy_1_1profiler_1_1_scope_label.html">ruy::profiler::ScopeLabel</a></div><div class="ttdef"><b>Definition</b> instrumentation.h:188</div></div>
<div class="ttc" id="aclassruy_1_1profiler_1_1_scope_label_html_a2022fde84a7503ebeb460c49465584ce"><div class="ttname"><a href="classruy_1_1profiler_1_1_scope_label.html#a2022fde84a7503ebeb460c49465584ce">ruy::profiler::ScopeLabel::~ScopeLabel</a></div><div class="ttdeci">~ScopeLabel()</div><div class="ttdef"><b>Definition</b> instrumentation.h:195</div></div>
<div class="ttc" id="aclassruy_1_1profiler_1_1_scope_label_html_af98ec6595418e55520942b3773735bad"><div class="ttname"><a href="classruy_1_1profiler_1_1_scope_label.html#af98ec6595418e55520942b3773735bad">ruy::profiler::ScopeLabel::ScopeLabel</a></div><div class="ttdeci">ScopeLabel(Args...)</div><div class="ttdef"><b>Definition</b> instrumentation.h:191</div></div>
<div class="ttc" id="aei__fill__result__struct_8h_html_ab36422f9ce90634e6563fb1f2905fb93"><div class="ttname"><a href="ei__fill__result__struct_8h.html#ab36422f9ce90634e6563fb1f2905fb93">labels</a></div><div class="ttdeci">const ei_learning_block_config_tflite_graph_t ei_impulse_result_t float float float * labels</div><div class="ttdef"><b>Definition</b> ei_fill_result_struct.h:280</div></div>
<div class="ttc" id="ahello__world__model_8cc_html_a439227feff9d7f55384e8780cfc2eb82"><div class="ttname"><a href="hello__world__model_8cc.html#a439227feff9d7f55384e8780cfc2eb82">size</a></div><div class="ttdeci">int size</div><div class="ttdef"><b>Definition</b> hello_world_model.cc:113</div></div>
<div class="ttc" id="anamespaceruy_html"><div class="ttname"><a href="namespaceruy.html">ruy</a></div><div class="ttdef"><b>Definition</b> instrumentation.h:25</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
