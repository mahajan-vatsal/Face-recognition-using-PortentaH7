<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: requantize_flatbuffer Namespace Reference</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">requantize_flatbuffer Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrequantize__flatbuffer_1_1_requantizer.html">Requantizer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac91c8716e55c2a370191eba18f1753ce" id="r_ac91c8716e55c2a370191eba18f1753ce"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac91c8716e55c2a370191eba18f1753ce">main</a> (_)</td></tr>
<tr class="separator:ac91c8716e55c2a370191eba18f1753ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a92b0891ff8aaa4770308582542ee0cfb" id="r_a92b0891ff8aaa4770308582542ee0cfb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a92b0891ff8aaa4770308582542ee0cfb">FLAGS</a> = flags.FLAGS</td></tr>
<tr class="separator:a92b0891ff8aaa4770308582542ee0cfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3291dc50524136e9a5a5220026c4c186" id="r_a3291dc50524136e9a5a5220026c4c186"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3291dc50524136e9a5a5220026c4c186">default</a></td></tr>
<tr class="separator:a3291dc50524136e9a5a5220026c4c186"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48873755b914a75e79cfce65d772d2ad" id="r_a48873755b914a75e79cfce65d772d2ad"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a48873755b914a75e79cfce65d772d2ad">help</a></td></tr>
<tr class="separator:a48873755b914a75e79cfce65d772d2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab356b62b6e1791b94e214d5a6e72bb34" id="r_ab356b62b6e1791b94e214d5a6e72bb34"><td class="memItemLeft" align="right" valign="top">dict&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab356b62b6e1791b94e214d5a6e72bb34">_COMPLEX_OP_REQUANTIZE_REGISTRATION</a></td></tr>
<tr class="separator:ab356b62b6e1791b94e214d5a6e72bb34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93914ce9674ff724fa508649e3b12578" id="r_a93914ce9674ff724fa508649e3b12578"><td class="memItemLeft" align="right" valign="top">list&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a93914ce9674ff724fa508649e3b12578">_TESTED_SIMPLE_OPS</a></td></tr>
<tr class="separator:a93914ce9674ff724fa508649e3b12578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbc82152ac07f36bd7b0ae227dcd1ba2" id="r_abbc82152ac07f36bd7b0ae227dcd1ba2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abbc82152ac07f36bd7b0ae227dcd1ba2">_SUPPORTED_OPS</a></td></tr>
<tr class="separator:abbc82152ac07f36bd7b0ae227dcd1ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">An experimental tool to requantize a int8 activation, int8 weight LSTM based model to int16 activation, int8 weight

Steps: 
1. Convert the trained model to int8 using the TFLite converter. See https://www.tensorflow.org/lite/performance/post_training_quantization#full_integer_quantization
2. Use this tool to requantize the int8 model to int16.
3. Check if the requantized model match the expectation (e.g., read the conversion printout, perform inference tests)

The conversion process: 
1. Requantize the ops specified in _COMPLEX_OP_REQUANTIZE_REGISTRATION using the registered function. Bias type conversion (int32 to int64) only happens here. 
2. Requantize all non-constant tensors with int8 type to int16 (and fix the quantization parameters)

Run:
bazel build tensorflow/lite/micro/tools:requantize_flatbuffer
bazel-bin/tensorflow/lite/micro/tools/requantize_flatbuffer --int8_model_path=".tflite file path"` --save_path="save path"

CAVEAT: 
1. Use this tool ONLY for models that contain the LSTM layer. All other models should use the standard tflite conversion process.
2. This is an experimental tool. ALWAYS check if the converted model matches your expectation
3. Add the custom op requantization function for complex ops (e.g., convolution). 
4. We assume ops not in _COMPLEX_OP_REQUANTIZE_REGISTRATION only have activation tensors (i.e. no weights and bias). Check the quantized model performance if you add additional ops to _TESTED_SIMPLE_OPS </pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="ac91c8716e55c2a370191eba18f1753ce" name="ac91c8716e55c2a370191eba18f1753ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac91c8716e55c2a370191eba18f1753ce">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">requantize_flatbuffer.main </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>_</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab356b62b6e1791b94e214d5a6e72bb34" name="ab356b62b6e1791b94e214d5a6e72bb34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab356b62b6e1791b94e214d5a6e72bb34">&#9670;&#160;</a></span>_COMPLEX_OP_REQUANTIZE_REGISTRATION</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">dict requantize_flatbuffer._COMPLEX_OP_REQUANTIZE_REGISTRATION</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  {</div>
<div class="line"><span class="lineno">    2</span>    schema_py_generated.BuiltinOperator.FULLY_CONNECTED:</div>
<div class="line"><span class="lineno">    3</span>    requantize_flatbuffer_utils.requantize_fully_connected,</div>
<div class="line"><span class="lineno">    4</span>    schema_py_generated.BuiltinOperator.UNIDIRECTIONAL_SEQUENCE_LSTM:</div>
<div class="line"><span class="lineno">    5</span>    requantize_flatbuffer_utils.requantize_unidirectional_sequence_lstm,</div>
<div class="line"><span class="lineno">    6</span>    schema_py_generated.BuiltinOperator.SOFTMAX:</div>
<div class="line"><span class="lineno">    7</span>    requantize_flatbuffer_utils.requantize_softmax,</div>
<div class="line"><span class="lineno">    8</span>    schema_py_generated.BuiltinOperator.CONV_2D:</div>
<div class="line"><span class="lineno">    9</span>    requantize_flatbuffer_utils.requantize_fully_connected,</div>
<div class="line"><span class="lineno">   10</span>    schema_py_generated.BuiltinOperator.DEPTHWISE_CONV_2D:</div>
<div class="line"><span class="lineno">   11</span>    requantize_flatbuffer_utils.requantize_fully_connected,</div>
<div class="line"><span class="lineno">   12</span>    schema_py_generated.BuiltinOperator.TRANSPOSE_CONV:</div>
<div class="line"><span class="lineno">   13</span>    requantize_flatbuffer_utils.requantize_transpose_conv,</div>
<div class="line"><span class="lineno">   14</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abbc82152ac07f36bd7b0ae227dcd1ba2" name="abbc82152ac07f36bd7b0ae227dcd1ba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbc82152ac07f36bd7b0ae227dcd1ba2">&#9670;&#160;</a></span>_SUPPORTED_OPS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">requantize_flatbuffer._SUPPORTED_OPS</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  set(</div>
<div class="line"><span class="lineno">    2</span>    list(_COMPLEX_OP_REQUANTIZE_REGISTRATION.keys()) + _TESTED_SIMPLE_OPS)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a93914ce9674ff724fa508649e3b12578" name="a93914ce9674ff724fa508649e3b12578"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93914ce9674ff724fa508649e3b12578">&#9670;&#160;</a></span>_TESTED_SIMPLE_OPS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">list requantize_flatbuffer._TESTED_SIMPLE_OPS</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"><span class="lineno">    1</span>=  [</div>
<div class="line"><span class="lineno">    2</span>    schema_py_generated.BuiltinOperator.ADD,</div>
<div class="line"><span class="lineno">    3</span>    schema_py_generated.BuiltinOperator.CONCATENATION,</div>
<div class="line"><span class="lineno">    4</span>    schema_py_generated.BuiltinOperator.DEQUANTIZE,</div>
<div class="line"><span class="lineno">    5</span>    schema_py_generated.BuiltinOperator.LEAKY_RELU,</div>
<div class="line"><span class="lineno">    6</span>    schema_py_generated.BuiltinOperator.LOGISTIC,</div>
<div class="line"><span class="lineno">    7</span>    schema_py_generated.BuiltinOperator.MEAN,</div>
<div class="line"><span class="lineno">    8</span>    schema_py_generated.BuiltinOperator.MUL,</div>
<div class="line"><span class="lineno">    9</span>    schema_py_generated.BuiltinOperator.PAD,</div>
<div class="line"><span class="lineno">   10</span>    schema_py_generated.BuiltinOperator.QUANTIZE,</div>
<div class="line"><span class="lineno">   11</span>    schema_py_generated.BuiltinOperator.RESHAPE,</div>
<div class="line"><span class="lineno">   12</span>    schema_py_generated.BuiltinOperator.RSQRT,</div>
<div class="line"><span class="lineno">   13</span>    schema_py_generated.BuiltinOperator.SQUARED_DIFFERENCE,</div>
<div class="line"><span class="lineno">   14</span>    schema_py_generated.BuiltinOperator.STRIDED_SLICE,</div>
<div class="line"><span class="lineno">   15</span>    schema_py_generated.BuiltinOperator.SUB,</div>
<div class="line"><span class="lineno">   16</span>]</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3291dc50524136e9a5a5220026c4c186" name="a3291dc50524136e9a5a5220026c4c186"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3291dc50524136e9a5a5220026c4c186">&#9670;&#160;</a></span>default</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">requantize_flatbuffer.default</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a92b0891ff8aaa4770308582542ee0cfb" name="a92b0891ff8aaa4770308582542ee0cfb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92b0891ff8aaa4770308582542ee0cfb">&#9670;&#160;</a></span>FLAGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">requantize_flatbuffer.FLAGS = flags.FLAGS</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a48873755b914a75e79cfce65d772d2ad" name="a48873755b914a75e79cfce65d772d2ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48873755b914a75e79cfce65d772d2ad">&#9670;&#160;</a></span>help</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">requantize_flatbuffer.help</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
