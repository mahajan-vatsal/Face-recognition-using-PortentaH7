<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Machine Vision using Portenta H7: Generate Micro Mutable Op Resolver from a model</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Machine Vision using Portenta H7<span id="projectnumber">&#160;2</span>
   </div>
   <div id="projectbrief">This project aims to develop a face recognition-based access control system using the Arduino Portenta H7 and Vision Shield, leveraging Edge Impulse for machine learning. The system captures facial images, processes them locally using an AI model deployed on the Portenta H7 and determines access based on authorised personnel.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Generate Micro Mutable Op Resolver from a model</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md339"></a></p>
<p>The MicroMutableOpResolver includes the operators explictly specified in source code. This generally requires manually finding out which operators are used in the model through the use of a visualization tool, which may be impractical in some cases. This script will automatically generate a MicroMutableOpResolver with only the used operators for a given model or set of models.</p>
<p>Note: Check ci/Dockerfile.micro for supported python version.</p>
<h1><a class="anchor" id="autotoc_md340"></a>
How to run</h1>
<p>bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:<a class="el" href="namespacegenerate__micro__mutable__op__resolver__from__model.html">generate_micro_mutable_op_resolver_from_model</a> &ndash; \ &ndash;common_tflite_path=&lt;path to tflite file&gt; \ &ndash;input_tflite_files=&lt;name of tflite file(s)&gt; &ndash;output_dir=&lt;output directory&gt;</p>
<p>Note that if having only one tflite as input, the final output directory will be &lt;output directory&gt;/&lt;base name of model&gt;.</p>
<p>Example:</p>
<div class="fragment"><div class="line">bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:generate_micro_mutable_op_resolver_from_model -- \</div>
<div class="line">             --common_tflite_path=/tmp/model_dir \</div>
<div class="line">             --input_tflite_files=person_detect.tflite --output_dir=/tmp/gen_dir</div>
</div><!-- fragment --><p>A header file called, gen_micro_mutable_op_resolver.h will be created in /tmp/gen_dir/person_detect.</p>
<p>Example:</p>
<div class="fragment"><div class="line">bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:generate_micro_mutable_op_resolver_from_model -- \</div>
<div class="line">             --common_tflite_path=/tmp/model_dir \</div>
<div class="line">             --input_tflite_files=person_detect.tflite,keyword_scrambled.tflite --output_dir=/tmp/gen_dir</div>
</div><!-- fragment --><p> A header file called, gen_micro_mutable_op_resolver.h will be created in /tmp/gen_dir.</p>
<p>Note that with multiple tflite files as input, the files must be placed in the same common directory.</p>
<p>The generated header file can then be included in the application and used like below:</p>
<div class="fragment"><div class="line">tflite::MicroMutableOpResolver&lt;kNumberOperators&gt; op_resolver = get_resolver();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md341"></a>
Verifying the content of the generated header file</h1>
<p>This is just to test the actual script that generates the micro mutable ops resolver header for a given model. So that the actual list of operators corresponds to a given model and that the syntax of the header is correct.</p>
<p>For this another script can be used to verify the generated header file:</p>
<div class="fragment"><div class="line">bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:generate_micro_mutable_op_resolver_from_model_test -- \</div>
<div class="line">             --input_tflite_file=&lt;path to tflite file&gt; --output_dir=&lt;output directory&gt;</div>
</div><!-- fragment --><p>This script verifies a single model at a time. It will generate a small inference testing app that is using the generated header file, which can then be executed and tested as a final step. Because of this the specified output path will be appended with the name of the model so that the generated test is named after the model. In other words the final output directory will be &lt;output directory&gt;/&lt;base name of model&gt;.</p>
<p>The essence of this is that different output paths need to be specified for the actual header script and the actual test script.</p>
<p>So there will be 3 steps, 1) Generate the micro mutable specifying e.g. output path gen_dir/&lt;base_name_of_model&gt; 2) Generate the micro mutable specifying e.g. output path gen_dir 3) Run the generated test</p>
<p>Example assuming /tmp/my_model.tflite exists:</p>
<div class="fragment"><div class="line"># Step 1 generates header to gen_dir/my_model</div>
<div class="line">bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:generate_micro_mutable_op_resolver_from_model -- \</div>
<div class="line">             --common_tflite_path=/tmp/ \</div>
<div class="line">             --input_tflite_files=my_model.tflite --output_dir=$(realpath gen_dir/my_model)</div>
<div class="line"> </div>
<div class="line"># Step 2 generates test app using header from step 1 to gen_dir/my_model since my my_model is appended</div>
<div class="line">bazel run tensorflow/lite/micro/tools/gen_micro_mutable_op_resolver:generate_micro_mutable_op_resolver_from_model_test -- \</div>
<div class="line">             --input_tflite_file=/tmp/my_model.tflite --output_dir=$(realpath gen_dir) --verify_output=1</div>
<div class="line"> </div>
<div class="line"># Step 3 runs the generated my_model test</div>
<div class="line">bazel run gen_dir/my_model:micro_mutable_op_resolver_test</div>
</div><!-- fragment --><p>Note1: Bazel expects absolute paths. Note2: By default the inference model test will run without any generated input or verifying the output. Verifying output can be done with &ndash;verify_output=1, which is done in the example above. Note3: Depending on the size of the model the arena size may need to be increased. Arena size can be set with &ndash;arena_size=&lt;size&gt;. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
