\doxysection{non\+\_\+persistent\+\_\+arena\+\_\+buffer\+\_\+allocator.\+h}
\hypertarget{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2src8c81a7d46103cc34dc4e59afc4025fee_source}{}\label{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2src8c81a7d46103cc34dc4e59afc4025fee_source}\index{Arduino/GetStartedWithMachineLearningOnArduino/tflite-\/micro-\/arduino-\/examples-\/main/src/tensorflow/lite/micro/arena\_allocator/non\_persistent\_arena\_buffer\_allocator.h@{Arduino/GetStartedWithMachineLearningOnArduino/tflite-\/micro-\/arduino-\/examples-\/main/src/tensorflow/lite/micro/arena\_allocator/non\_persistent\_arena\_buffer\_allocator.h}}
\mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2src8c81a7d46103cc34dc4e59afc4025fee}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ Copyright\ 2022\ The\ TensorFlow\ Authors.\ All\ Rights\ Reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{}}
\DoxyCodeLine{00003\ \textcolor{comment}{Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00004\ \textcolor{comment}{you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00005\ \textcolor{comment}{You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00006\ \textcolor{comment}{}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00008\ \textcolor{comment}{}}
\DoxyCodeLine{00009\ \textcolor{comment}{Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00010\ \textcolor{comment}{distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00011\ \textcolor{comment}{WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00012\ \textcolor{comment}{See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00013\ \textcolor{comment}{limitations\ under\ the\ License.}}
\DoxyCodeLine{00014\ \textcolor{comment}{==============================================================================*/}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#ifndef\ TENSORFLOW\_LITE\_MICRO\_ARENA\_ALLOCATOR\_NON\_PERSISTENT\_ARENA\_BUFFER\_ALLOCATOR\_H\_}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ TENSORFLOW\_LITE\_MICRO\_ARENA\_ALLOCATOR\_NON\_PERSISTENT\_ARENA\_BUFFER\_ALLOCATOR\_H\_}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <cstddef>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <cstdint>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}tensorflow/lite/c/common.h"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}tensorflow/lite/micro/arena\_allocator/ibuffer\_allocator.h"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}tensorflow/lite/micro/compatibility.h"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetflite}{tflite}}\ \{}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{comment}{//\ Implement\ INonPersistentBufferAllocator\ on\ an\ arena\ that\ is\ dedicated\ for}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ non-\/persistent\ buffers.}}
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }NonPersistentArenaBufferAllocator\ :\ \textcolor{keyword}{public}\ INonPersistentBufferAllocator\ \{}
\DoxyCodeLine{00030\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_ac67b5d04eeccbfd1958f4035668ca3db}{NonPersistentArenaBufferAllocator}}(uint8\_t*\ \mbox{\hyperlink{nano__ble33__sense__accelerometer__continuous_8ino_a221f01f29c6cba77d9479aba615283f5}{buffer}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{stacker_8cc_a799a743b3abd553a37fc01ad3097df08}{buffer\_size}});}
\DoxyCodeLine{00032\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a17fd32115c72e6e9ed64a43b339b57b0}{\string~NonPersistentArenaBufferAllocator}}();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ Allocates\ a\ temporary\ buffer.\ This\ buffer\ is\ not\ resizable.}}
\DoxyCodeLine{00035\ \ \ uint8\_t*\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_ac91b9961f308f04582d28c445cae004a}{AllocateTemp}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{hello__world__model_8cc_a439227feff9d7f55384e8780cfc2eb82}{size}},\ \textcolor{keywordtype}{size\_t}\ alignment)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ Signals\ that\ a\ temporary\ buffer\ is\ no\ longer\ needed.}}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a8f8de7254c6acc48831690db4906b6b2}{DeallocateTemp}}(uint8\_t*\ buf)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ Returns\ true\ if\ all\ temporary\ buffers\ are\ already\ deallocated.}}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_aa9905dadf0eca5c929a134244421390d}{IsAllTempDeallocated}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Signals\ that\ all\ temporary\ allocations\ can\ be\ reclaimed.\ TFLM\ calls\ this}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ API\ when\ it\ knows\ that\ all\ temporary\ buffers\ that\ it\ requested\ has\ been}}
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ deallocated.}}
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcf7df9e575f8a1f1a49c58fb0f49428b8_acf79d2fb5fa520303014d1303f1f6361}{TfLiteStatus}}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a9c80f0eb0062d9980122b0a1c27e3fcc}{ResetTempAllocations}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ Returns\ a\ buffer\ that\ is\ resizable\ viable\ ResizeBuffer().}}
\DoxyCodeLine{00049\ \ \ uint8\_t*\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a5e3c750cf0061e29ba4d5a8ded1317f9}{AllocateResizableBuffer}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{hello__world__model_8cc_a439227feff9d7f55384e8780cfc2eb82}{size}},\ \textcolor{keywordtype}{size\_t}\ alignment)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Resizes\ a\ buffer\ that\ is\ previously\ returned\ by\ the}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ AllocateResizableBuffer.}}
\DoxyCodeLine{00053\ \ \ \mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcf7df9e575f8a1f1a49c58fb0f49428b8_acf79d2fb5fa520303014d1303f1f6361}{TfLiteStatus}}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a319934c95667f36bf6753c3f21c2ee6b}{ResizeBuffer}}(uint8\_t*\ resizable\_buf,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{hello__world__model_8cc_a439227feff9d7f55384e8780cfc2eb82}{size}},}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ alignment)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ Frees\ up\ the\ memory\ occupied\ by\ the\ resizable\ buffer.}}
\DoxyCodeLine{00057\ \ \ \mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcf7df9e575f8a1f1a49c58fb0f49428b8_acf79d2fb5fa520303014d1303f1f6361}{TfLiteStatus}}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a651893ce591eebb66e962c1e56ebb93d}{DeallocateResizableBuffer}}(uint8\_t*\ resizable\_buf)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ Returns\ a\ pointer\ pointing\ to\ the\ start\ of\ the\ overlay\ memory,\ which\ is}}
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ used\ for\ activation\ tensors\ and\ scratch\ buffers\ by\ kernels\ at\ Invoke\ stage.}}
\DoxyCodeLine{00061\ \ \ uint8\_t*\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_ae4a5e58ee3a5678222005979b3bb1899}{GetOverlayMemoryAddress}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ Reserves\ the\ size\ of\ the\ overlay\ memory.\ This\ overlay\ is\ reserved\ for\ the}}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ kernels\ at\ Invoke\ stage.\ This\ is\ referred\ to\ as\ the\ overlay\ because\ before}}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ Invoket\ state,\ the\ same\ memory\ can\ be\ used\ for\ temp\ buffers.\ The\ layout\ of}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ the\ memory\ is\ planned\ by\ the\ memory\ planner\ separately\ at\ Invoke\ stage.}}
\DoxyCodeLine{00067\ \ \ \mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2srcf7df9e575f8a1f1a49c58fb0f49428b8_acf79d2fb5fa520303014d1303f1f6361}{TfLiteStatus}}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a888274e4a7c0b149336b09ccf404185c}{ReserveNonPersistentOverlayMemory}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{hello__world__model_8cc_a439227feff9d7f55384e8780cfc2eb82}{size}},}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ alignment)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{//\ Returns\ the\ size\ of\ non-\/persistent\ buffer\ in\ use.}}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_aac1d526dec452393f22e3d7a70c76651}{GetNonPersistentUsedBytes}}()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ Returns\ the\ number\ of\ bytes\ available\ with\ a\ given\ alignment.\ This\ number}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ takes\ in\ account\ any\ temporary\ allocations.}}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_ac4d2ec2a84bf9fb842fe635d92eaaba4}{GetAvailableMemory}}(\textcolor{keywordtype}{size\_t}\ alignment)\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \mbox{\hyperlink{_arduino_2_get_started_with_machine_learning_on_arduino_2tflite-micro-arduino-examples-main_2src336b24cffab807348972c47c46f8de00_a92a34c72cfcc4f6c5bd49086ba082af4}{TF\_LITE\_REMOVE\_VIRTUAL\_DELETE}}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ The\ memory\ arena\ that\ this\ allocator\ manages.}}
\DoxyCodeLine{00081\ \ \ uint8\_t*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a2835c3827138c046cab5fbbc7ecacf1b}{buffer\_head\_}};}
\DoxyCodeLine{00082\ \ \ uint8\_t*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a13d26e0e59afff40d8dd8482e3a04d27}{buffer\_tail\_}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//\ The\ whole\ region\ is\ split\ into\ two\ parts:}}
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ buffer\_head\_\ to\ head\_temp\_\ -\/\ 1\ belongs\ to\ the\ only\ resizable\ buffer.}}
\DoxyCodeLine{00086\ \ \ \textcolor{comment}{//\ head\_temp\_\ to\ buffer\_tail\_\ can\ be\ used\ for\ (non-\/resizable)\ temp\ buffers.}}
\DoxyCodeLine{00087\ \ \ uint8\_t*\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a797775532440ecff47aa0242686d34d3}{head\_temp\_}};}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ next\_temp\_\ points\ to\ the\ next\ available\ temp\ buffer\ allocation\ address\ and}}
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ its\ range\ is\ between\ head\_temp\_\ and\ buffer\_tail\_}}
\DoxyCodeLine{00091\ \ \ uint8\_t*\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a4353613f1515d5eabe380fd88b4fdf0f}{next\_temp\_}};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ XOR\ Check\ sum\ for\ outstanding\ temp\ buffers.}}
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ If\ all\ temp\ buffers\ are\ deallocated\ OR\ no\ temp\ buffers\ are\ allocated,}}
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ temp\_buffer\_ptr\_check\_sum\_\ ==\ nullptr.}}
\DoxyCodeLine{00096\ \ \ intptr\_t\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a9eec06ce611b06acbc200c7da9b61570}{temp\_buffer\_ptr\_check\_sum\_}}\ =\ 0;}
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ Count\ of\ outstanding\ temp\ buffers.}}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_ab59f6370202721ed769bbfc2e88169b0}{temp\_buffer\_count\_}}\ =\ 0;}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtflite_1_1_non_persistent_arena_buffer_allocator_a8f80eeef5346b5a71e79f9c0b6af5bc3}{resizable\_buffer\_allocated\_}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00100\ \};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \}\ \ \textcolor{comment}{//\ namespace\ tflite}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ TENSORFLOW\_LITE\_MICRO\_ARENA\_ALLOCATOR\_NON\_PERSISTENT\_ARENA\_BUFFER\_ALLOCATOR\_H\_}}

\end{DoxyCode}
