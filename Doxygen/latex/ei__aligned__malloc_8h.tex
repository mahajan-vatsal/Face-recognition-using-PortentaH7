\doxysection{Face\+\_\+\+Access\+\_\+inferencing/src/edge-\/impulse-\/sdk/classifier/ei\+\_\+aligned\+\_\+malloc.h File Reference}
\hypertarget{ei__aligned__malloc_8h}{}\label{ei__aligned__malloc_8h}\index{Face\_Access\_inferencing/src/edge-\/impulse-\/sdk/classifier/ei\_aligned\_malloc.h@{Face\_Access\_inferencing/src/edge-\/impulse-\/sdk/classifier/ei\_aligned\_malloc.h}}
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include "{}../porting/ei\+\_\+classifier\+\_\+porting.\+h"{}}\newline
Include dependency graph for ei\+\_\+aligned\+\_\+malloc.\+h\+:
% FIG 0
This graph shows which files directly or indirectly include this file\+:
% FIG 1
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{ei__aligned__malloc_8h_ad7cedda95a9788a1df13133fabd15ce5}{align\+\_\+up}}(num,  align)
\item 
\#define \mbox{\hyperlink{ei__aligned__malloc_8h_ae270c0b6ce92c0334142b6ac81ea047d}{PTR\+\_\+\+OFFSET\+\_\+\+SZ}}~sizeof(\mbox{\hyperlink{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a}{offset\+\_\+t}})
\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint16\+\_\+t \mbox{\hyperlink{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a}{offset\+\_\+t}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{ei__aligned__malloc_8h_ga8f5c7143bf386c91e3210280ebc152d6}{\+\_\+\+\_\+attribute\+\_\+\+\_\+}} ((unused)) void \texorpdfstring{$\ast$}{*}ei\+\_\+aligned\+\_\+calloc(size\+\_\+t align
\begin{DoxyCompactList}\small\item\em Initialize static variables for running preprocessing and inference continuously. \end{DoxyCompactList}\item 
\mbox{\hyperlink{ei__aligned__malloc_8h_a95cd4fa643ce672b347744b35c5b7056}{assert}} ((align \&(align -\/ 1))==0)
\item 
\mbox{\hyperlink{ei__aligned__malloc_8h_a86a06b36806fdb43189c9cc48ca47bf5}{if}} (align \&\&\mbox{\hyperlink{hello__world__model_8cc_a439227feff9d7f55384e8780cfc2eb82}{size}})
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
size\+\_\+t \mbox{\hyperlink{ei__aligned__malloc_8h_a854352f53b148adc24983a58a1866d66}{size}}
\item 
return \mbox{\hyperlink{ei__aligned__malloc_8h_a0619a76ea2d4e6cce18b93ddf5082a36}{ptr}}
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{ei__aligned__malloc_8h_ad7cedda95a9788a1df13133fabd15ce5}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!align\_up@{align\_up}}
\index{align\_up@{align\_up}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{align\_up}{align\_up}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_ad7cedda95a9788a1df13133fabd15ce5} 
\#define align\+\_\+up(\begin{DoxyParamCaption}\item[{}]{num}{, }\item[{}]{align}{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \ \ \ (((num)\ +\ ((align)\ -\/\ 1))\ \&\ \string~((align)\ -\/\ 1))}

\end{DoxyCode}
Based on \href{https://github.com/embeddedartistry/embedded-resources/blob/master/examples/c/malloc_aligned.c}{\texttt{ https\+://github.\+com/embeddedartistry/embedded-\/resources/blob/master/examples/c/malloc\+\_\+aligned.\+c}} Simple macro for making sure memory addresses are aligned to the nearest power of two \Hypertarget{ei__aligned__malloc_8h_ae270c0b6ce92c0334142b6ac81ea047d}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!PTR\_OFFSET\_SZ@{PTR\_OFFSET\_SZ}}
\index{PTR\_OFFSET\_SZ@{PTR\_OFFSET\_SZ}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{PTR\_OFFSET\_SZ}{PTR\_OFFSET\_SZ}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_ae270c0b6ce92c0334142b6ac81ea047d} 
\#define PTR\+\_\+\+OFFSET\+\_\+\+SZ~sizeof(\mbox{\hyperlink{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a}{offset\+\_\+t}})}



\doxysubsection{Typedef Documentation}
\Hypertarget{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!offset\_t@{offset\_t}}
\index{offset\_t@{offset\_t}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{offset\_t}{offset\_t}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a} 
typedef uint16\+\_\+t \mbox{\hyperlink{ei__aligned__malloc_8h_a310df0c401bac7455ba4512bf170044a}{offset\+\_\+t}}}



\doxysubsection{Function Documentation}
\Hypertarget{ei__aligned__malloc_8h_ga8f5c7143bf386c91e3210280ebc152d6}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!\_\_attribute\_\_@{\_\_attribute\_\_}}
\index{\_\_attribute\_\_@{\_\_attribute\_\_}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{\_\_attribute\_\_()}{\_\_attribute\_\_()}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_ga8f5c7143bf386c91e3210280ebc152d6} 
\+\_\+\+\_\+attribute\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{(unused)}]{}{}\end{DoxyParamCaption})}



Initialize static variables for running preprocessing and inference continuously. 

Calculates the cepstral mean and variable normalization.

Run preprocessing (DSP) on new slice of raw features. Add output features to rolling matrix and run inference on full sample.

aligned\+\_\+malloc takes in the requested alignment and size We will call malloc with extra bytes for our header and the offset required to guarantee the desired alignment.

aligned\+\_\+free works like free(), but we work backwards from the returned pointer to find the correct offset and pointer location to return to free() Note that it is VERY BAD to call free() on an aligned\+\_\+malloc() pointer.

Checks whether a new section overlaps with a cube, and if so, will {\bfseries{update the cube}}

Fill the result structure from an unquantized output tensor (we don\textquotesingle{}t support quantized here a.\+t.\+m.)

Fill the result structure from a quantized output tensor

Fill the result structure from an unquantized output tensor

Fill the visual anomaly result structures from an unquantized output tensor

Check if the current impulse could be used by \textquotesingle{}run\+\_\+classifier\+\_\+image\+\_\+quantized\textquotesingle{}

Initializes and clears any internal static variables needed by {\ttfamily \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}}. This includes the moving average filter (MAF). This function should be called prior to calling {\ttfamily \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}}.

{\bfseries{Blocking}}\+: yes

{\bfseries{Example}}\+: \href{https://github.com/edgeimpulse/example-lacuna-ls200/blob/main/nano_ble33_sense_microphone_continous/nano_ble33_sense_microphone_continuous.ino}{\texttt{ nano\+\_\+ble33\+\_\+sense\+\_\+microphone\+\_\+continuous.\+ino}}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & struct with information about model and DSP\\
\hline
\end{DoxyParams}
Accepts a new slice of features give by the callback defined in the {\ttfamily signal} parameter. It performs preprocessing (DSP) on this new slice of features and appends the output to a sliding window of pre-\/processed features (stored in a static features matrix). The matrix stores the new slice and as many old slices as necessary to make up one full sample for performing inference.

{\ttfamily \doxylink{group__ei__functions_ga1f01a5a562ec8528c0b5fe61aa9dacc3}{run\+\_\+classifier\+\_\+init()}} must be called before making any calls to {\ttfamily \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}.}

For example, if you are doing keyword spotting on 1-\/second slices of audio and you want to perform inference 4 times per second (given by {\ttfamily EI\+\_\+\+CLASSIFIER\+\_\+\+SLICES\+\_\+\+PER\+\_\+\+MODEL\+\_\+\+WINDOW}), you would collect 0.\+25 seconds of audio and call \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}. The function would compute the Mel-\/\+Frequency Cepstral Coefficients (MFCCs) for that 0.\+25 second slice of audio, drop the oldest 0.\+25 seconds\textquotesingle{} worth of MFCCs from its internal matrix, and append the newest slice of MFCCs. This process allows the library to keep track of the pre-\/processed features (e.\+g. MFCCs) in the window instead of the entire set of raw features (e.\+g. raw audio data), which can potentially save a lot of space in RAM. After updating the static matrix, inference is performed using the whole matrix, which acts as a sliding window of pre-\/processed features.

Additionally, a moving average filter (MAF) can be enabled for {\ttfamily \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}}, which averages (arithmetic mean) the last {\itshape n} inference results for each class. {\itshape n} is {\ttfamily EI\+\_\+\+CLASSIFIER\+\_\+\+SLICES\+\_\+\+PER\+\_\+\+MODEL\+\_\+\+WINDOW / 2}. In our example above, if we enabled the MAF, the values in {\ttfamily result} would contain predictions averaged from the previous 2 inferences.

To learn more about {\ttfamily \doxylink{group__ei__functions_gacf3414ec2ec4639e982fc966144a02ec}{run\+\_\+classifier\+\_\+continuous()}}, see \href{https://docs.edgeimpulse.com/docs/tutorials/advanced-inferencing/continuous-audio-sampling}{\texttt{ this guide}} on continuous audio sampling. While the guide is written for audio signals, the concepts of continuous sampling and inference can be extrapolated to any time-\/series data.

{\bfseries{Blocking}}\+: yes

{\bfseries{Example}}\+: \href{https://github.com/edgeimpulse/example-lacuna-ls200/blob/main/nano_ble33_sense_microphone_continous/nano_ble33_sense_microphone_continuous.ino}{\texttt{ nano\+\_\+ble33\+\_\+sense\+\_\+microphone\+\_\+continuous.\+ino}}


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em impulse} & {\ttfamily \doxylink{classei__impulse__handle__t}{ei\+\_\+impulse\+\_\+handle\+\_\+t}} struct with information about preprocessing and model. \\
\hline
\mbox{\texttt{ in}}  & {\em signal} & Pointer to a signal\+\_\+t struct that contains the number of elements in the slice of raw features (e.\+g. {\ttfamily EI\+\_\+\+CLASSIFIER\+\_\+\+SLICE\+\_\+\+SIZE}) and a pointer to a callback that reads in the slice of raw features. \\
\hline
\mbox{\texttt{ out}}  & {\em result} & Pointer to an {\ttfamily \doxylink{structei__impulse__result__t}{ei\+\_\+impulse\+\_\+result\+\_\+t}} struct that contains the various output results from inference after run\+\_\+classifier() returns. \\
\hline
\mbox{\texttt{ in}}  & {\em debug} & Print internal preprocessing and inference debugging information via {\ttfamily \doxylink{ei__run__dsp_8h_aa172a441ef3801477fc607c4a77ffede}{ei\+\_\+printf()}}. \\
\hline
\mbox{\texttt{ in}}  & {\em enable\+\_\+maf\+\_\+unused} & Enable the moving average filter (MAF) for the classifier -\/ deprecated, replaced with Performance Calibration\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code as defined by {\ttfamily EI\+\_\+\+IMPULSE\+\_\+\+ERROR} enum. Will be {\ttfamily EI\+\_\+\+IMPULSE\+\_\+\+OK} if inference completed successfully.
\end{DoxyReturn}
Clear all state regarding continuous audio. Invoke this function after continuous audio loop ends.


\begin{DoxyParams}{Parameters}
{\em matrix} & Source and destination matrix \\
\hline
{\em config\+\_\+ptr} & \doxylink{structei__dsp__config__mfcc__t}{ei\+\_\+dsp\+\_\+config\+\_\+mfcc\+\_\+t} struct pointer\\
\hline
{\em matrix} & Source and destination matrix \\
\hline
{\em config\+\_\+ptr} & \doxylink{structei__dsp__config__mfe__t}{ei\+\_\+dsp\+\_\+config\+\_\+mfe\+\_\+t} struct pointer\\
\hline
{\em matrix} & Source and destination matrix \\
\hline
{\em config\+\_\+ptr} & \doxylink{structei__dsp__config__spectrogram__t}{ei\+\_\+dsp\+\_\+config\+\_\+spectrogram\+\_\+t} struct pointer \\
\hline
\end{DoxyParams}
\Hypertarget{ei__aligned__malloc_8h_a95cd4fa643ce672b347744b35c5b7056}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!assert@{assert}}
\index{assert@{assert}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{assert()}{assert()}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_a95cd4fa643ce672b347744b35c5b7056} 
assert (\begin{DoxyParamCaption}\item[{(align \&(align -\/ 1))}]{}{ = {\ttfamily =0}}\end{DoxyParamCaption})}

\Hypertarget{ei__aligned__malloc_8h_a86a06b36806fdb43189c9cc48ca47bf5}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!if@{if}}
\index{if@{if}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{if()}{if()}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_a86a06b36806fdb43189c9cc48ca47bf5} 
if (\begin{DoxyParamCaption}\item[{align \&\&}]{size}{}\end{DoxyParamCaption})}



\doxysubsection{Variable Documentation}
\Hypertarget{ei__aligned__malloc_8h_a0619a76ea2d4e6cce18b93ddf5082a36}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!ptr@{ptr}}
\index{ptr@{ptr}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{ptr}{ptr}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_a0619a76ea2d4e6cce18b93ddf5082a36} 
return ptr}

\Hypertarget{ei__aligned__malloc_8h_a854352f53b148adc24983a58a1866d66}\index{ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}!size@{size}}
\index{size@{size}!ei\_aligned\_malloc.h@{ei\_aligned\_malloc.h}}
\doxysubsubsection{\texorpdfstring{size}{size}}
{\footnotesize\ttfamily \label{ei__aligned__malloc_8h_a854352f53b148adc24983a58a1866d66} 
size\+\_\+t size}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{ei__aligned__malloc_8h_a0619a76ea2d4e6cce18b93ddf5082a36}{ptr}}\ =\ NULL}

\end{DoxyCode}
